<div id="historyContainer"></div>

<script>
const username = "{{ session.get('username') or 'guest' }}";  // ← Flaskからユーザー名を取得
const historyKey = `plantHistory_${username}`;                // ← ユーザーごとのキーを設定
const historyData = JSON.parse(localStorage.getItem(historyKey)) || [];

const container = document.getElementById('historyContainer');

if (historyData.length === 0) {
    container.innerHTML = '<p>履歴はありません</p>';
} else {
    historyData.forEach(item => {
        const div = document.createElement('div');
        div.innerHTML = `
            <div style="margin-bottom:20px; border:1px solid #ccc; padding:10px; border-radius:10px;">
                <img src="${item.image_url}" style="max-width:150px; display:block; margin-bottom:10px;">
                <div>最初の結果: ${item.results[0].species.scientificNameWithoutAuthor}</div>
                <div>確信度: ${(item.results[0].score * 100).toFixed(1)}%</div>
                <div>${new Date(item.timestamp).toLocaleString()}</div>
            </div>
        `;
        container.appendChild(div);
    });
}

// ✅ 戻るボタンを動的に追加する部分
const backButton = document.createElement('button');
backButton.textContent = '戻る';
backButton.style.position = 'fixed';
backButton.style.bottom = '20px';
backButton.style.right = '20px';
backButton.style.padding = '12px 18px';
backButton.style.backgroundColor = '#66bb6a';
backButton.style.color = 'white';
backButton.style.border = 'none';
backButton.style.borderRadius = '8px';
backButton.style.fontSize = '16px';
backButton.style.cursor = 'pointer';
backButton.style.boxShadow = '0 4px 10px rgba(0,0,0,0.2)';
backButton.style.transition = 'all 0.3s ease';

// ホバー時の見た目変更
backButton.addEventListener('mouseover', () => {
    backButton.style.backgroundColor = '#43a047';
});
backButton.addEventListener('mouseout', () => {
    backButton.style.backgroundColor = '#66bb6a';
});

// 戻るボタンクリック時の動作
backButton.addEventListener('click', () => {
    window.location.href = '/';
});

// 画面に追加
document.body.appendChild(backButton);
</script>
