<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å±¥æ­´ | é£Ÿç‰©ç”»åƒèªè­˜ã‚¢ãƒ—ãƒª</title>
<style>
body {
    margin:0; padding:10px; font-family:'Poppins', sans-serif;
    background: linear-gradient(135deg, #a8e6cf, #dcedc1);
}
#historyContainer > div {
    margin-bottom:20px; border:1px solid #ccc; padding:10px; border-radius:10px;
    background:#fff; max-width:380px; width:100%; margin:auto; box-sizing:border-box; cursor:pointer;
}
#historyContainer img { width:100%; border-radius:8px; display:block; margin-bottom:10px; }
#historyContainer div { font-size:14px; color:#333; line-height:1.4; }
#historyContainer p { text-align:center; font-size:16px; color:#666; }
button#backButton { position:fixed; bottom:20px; right:20px; padding:12px 18px; background:#66bb6a; color:white; border:none; border-radius:8px; font-size:16px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.2);}
button#backButton:hover { background:#43a047; }
</style>
</head>
<body>

<h2 style="text-align:center;">ğŸ“œ å±¥æ­´</h2>
<div id="historyContainer"></div>

<script>
const username = "{{ session.get('username') or 'guest' }}";  
const historyKey = `plantHistory_${username}`;                
const historyData = JSON.parse(localStorage.getItem(historyKey)) || [];
const container = document.getElementById('historyContainer');

if(historyData.length === 0){
    container.innerHTML = '<p>å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
}else{
    historyData.forEach(item => {
        const div = document.createElement('div');
        div.innerHTML = `
            <img src="${item.image_url}">
            <div>æœ€åˆã®çµæœ: ${item.results[0].species.scientificNameWithoutAuthor}</div>
            <div>ç¢ºä¿¡åº¦: ${(item.results[0].score*100).toFixed(1)}%</div>
            <div>${new Date(item.timestamp).toLocaleString()}</div>
        `;
        div.addEventListener('click', () => {
            localStorage.setItem('uploadImage', item.image_url);
            window.location.href = '/';
        });
        container.appendChild(div);
    });
}

// æˆ»ã‚‹ãƒœã‚¿ãƒ³
const backButton = document.createElement('button');
backButton.id = 'backButton';
backButton.textContent = 'æˆ»ã‚‹';
backButton.addEventListener('click', ()=>{ window.location.href = '/'; });
document.body.appendChild(backButton);
</script>

</body>
</html>
