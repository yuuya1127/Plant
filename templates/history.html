<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>履歴 | 食物画像認識アプリ</title>
<style>
body {
    margin:0; padding:10px; font-family:'Poppins', sans-serif;
    background: linear-gradient(135deg, #a8e6cf, #dcedc1);
}
#historyContainer {
    display:flex;
    flex-direction:column;
    gap:15px;
}
.history-item {
    background:#fff;
    padding:12px;
    border-radius:10px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}
.history-img {
    width:30%;
    border-radius:10px;
}
.result-title {
    font-size:18px;
    font-weight:bold;
    margin-top:8px;
}
.result-score {
    font-size:14px;
    color:#444;
}
.result-time {
    font-size:12px;
    color:#666;
}

/* 右下に固定される戻るボタン */
#backButton {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 12px 20px;
    background: #4caf50;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    cursor: pointer;
}
</style>
</head>
<body>

<h2>履歴</h2>
<div id="historyContainer">読み込み中...</div>

<script>
// -----------------------------
// DBの履歴をAPIから取得して表示
// -----------------------------
async function loadHistory() {
    const container = document.getElementById('historyContainer');
    container.innerHTML = "読み込み中...";

    try {
        const res = await fetch("/api/history");

        if (!res.ok) {
            container.innerHTML = "履歴を読み込めません";
            return;
        }

        const data = await res.json();

        if (data.length === 0) {
            container.innerHTML = "履歴がありません。";
            return;
        }

        container.innerHTML = ""; // 一旦クリア

        data.forEach(item => {
            const div = document.createElement("div");
            div.className = "history-item";

            div.innerHTML = `
                <img src="${item.image_path}" class="history-img">
                <div class="result-title">${item.result}</div>
                <div class="result-score">スコア: ${item.score}</div>
                <div class="result-time">${item.timestamp}</div>
            `;

            container.appendChild(div);
        });

    } catch (err) {
        console.error(err);
        container.innerHTML = "エラーが発生しました。";
    }
}

// ページ読み込み時に実行
loadHistory();

// 戻るボタン
const backButton = document.createElement('button');
backButton.id = 'backButton';
backButton.textContent = '戻る';
backButton.addEventListener('click', ()=>{ 
    window.location.href = '/'; 
});

// ← ここが修正ポイント！ appendChildで追加
document.body.appendChild(backButton);

</script>

</body>
</html>
