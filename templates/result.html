<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>識別結果 - 植物識別アプリ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #d1fae5 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #166534; font-size: 2.5rem; margin-bottom: 10px; }
 
        .back-btn {
            background: #6b7280; color: white;
            border: none; padding: 12px 30px;
            font-size: 1rem; font-weight: 600;
            border-radius: 10px; cursor: pointer;
            margin-bottom: 20px;
        }
 
        .image-section, .results-section {
            background: white; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px; margin-bottom: 30px;
        }
 
        .uploaded-image { max-width: 100%; max-height: 400px; border-radius: 15px; }
 
        .section-title {
            color: #166534; font-size: 1.8rem;
            margin-bottom: 20px; font-weight: 600;
        }
 
        /* ----- Gemini説明 ----- */
        .gemini-box {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }
        .gemini-title {
            font-size: 1.6rem;
            font-weight: bold;
            color: #166534;
            margin-bottom: 10px;
        }
        .gemini-text {
            font-size: 1rem;
            color: #374151;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        
    </style>
</head>
 
<body>
<div class="container">
    <button class="back-btn" onclick="location.href='/'">← 画像選択に戻る</button>
 
    <div class="header">
        <h1>識別結果</h1>
    </div>
 
    <div class="image-section">
        <img id="uploadedImage" class="uploaded-image" alt="植物画像">
    </div>
 
    <div class="results-section">
        <h2 class="section-title">識別結果</h2>
        <div id="mainResult"></div>
        <div id="otherResults"></div>
    </div>
 
    <!-- ★★ Gemini説明エリア ★★ -->
    <div class="results-section" id="gemini-section" style="display:none;">
        <h2 class="section-title">植物の説明（AIによる生成）</h2>
 
        <div class="gemini-box">
            <div class="gemini-title">花言葉</div>
            <div class="gemini-text" id="g_flower"></div>
        </div>
 
        <div class="gemini-box">
            <div class="gemini-title">由来</div>
            <div class="gemini-text" id="g_origin"></div>
        </div>
 
        <div class="gemini-box">
            <div class="gemini-title">栽培方法</div>
            <div class="gemini-text" id="g_howto"></div>
        </div>
 
        <div class="gemini-box">
            <div class="gemini-title">特徴</div>
            <div class="gemini-text" id="g_features"></div>
        </div>
 
    </div>
 
</div>
 
<script>
    const data = JSON.parse(localStorage.getItem("plantResults"));
 
    if (!data) {
        alert("結果データがありません。");
        location.href = "/";
    }
 
    document.getElementById("uploadedImage").src = data.image_url;
 
    /* ======= PlantNet結果の表示 ======= */
    if (data.results && data.results.length > 0) {
        const top = data.results[0];
        document.getElementById("mainResult").innerHTML = `
            <div>
                <h3>${top.species.scientificNameWithoutAuthor}</h3>
                <p>${top.species.commonNames?.join(", ") || "一般名なし"}</p>
                <p>確信度: ${(top.score * 100).toFixed(1)}%</p>
            </div>
        `;
    }
 
    /* ======= ★★★ Geminiの説明表示 ★★★ ======= */
    const g = data.gemini_description;
    if (g) {
        document.getElementById("gemini-section").style.display = "block";
 
        document.getElementById("g_flower").textContent   = g["花言葉"] || "説明なし";
        document.getElementById("g_origin").textContent   = g["由来"] || "説明なし";
        document.getElementById("g_howto").textContent    = g["栽培方法"] || "説明なし";
        document.getElementById("g_features").textContent = g["特徴"] || "説明なし";
    }
</script>
</body>
</html>